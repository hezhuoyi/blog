<!DOCTYPE html>
<html lang="zh-US">
  <head>
    <link rel="manifest" href="/blog/manifest.webmanifest"><title>从输入URL到页面呈现 | Johnny's blog</title><meta name="description" content="认真分享和记录各类好文，逐步完善大前端知识体系。"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.22">
    <link rel="preload" href="/blog/assets/js/runtime~app.5b40ce10.js" as="script"><link rel="preload" href="/blog/assets/css/styles.678e5aee.css" as="style"><link rel="preload" href="/blog/assets/js/981.9765ac40.js" as="script"><link rel="preload" href="/blog/assets/js/app.3e27996d.js" as="script">
    <link rel="stylesheet" href="/blog/assets/css/styles.678e5aee.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/blog/" class=""><!----><span class="site-name">Johnny&#39;s blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/blog/JavaScript/" class="nav-link" aria-label="深入JavaScript"><!--[--><!--]--> 深入JavaScript <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Network/" class="nav-link" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Browser/" class="nav-link router-link-active" aria-label="浏览器相关"><!--[--><!--]--> 浏览器相关 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Framework/" class="nav-link" aria-label="框架和类库"><!--[--><!--]--> 框架和类库 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Engineering/" class="nav-link" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/NewTechnology/" class="nav-link" aria-label="新技术/方向"><!--[--><!--]--> 新技术/方向 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://hezhuoyi.github.io/leetcode" rel="noopener noreferrer" target="_blank" aria-label="LeetCode"><!--[--><!--]--> LeetCode <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/hezhuoyi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://juejin.cn/user/3597257778155703" rel="noopener noreferrer" target="_blank" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/blog/JavaScript/" class="nav-link" aria-label="深入JavaScript"><!--[--><!--]--> 深入JavaScript <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Network/" class="nav-link" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Browser/" class="nav-link router-link-active" aria-label="浏览器相关"><!--[--><!--]--> 浏览器相关 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Framework/" class="nav-link" aria-label="框架和类库"><!--[--><!--]--> 框架和类库 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Engineering/" class="nav-link" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/NewTechnology/" class="nav-link" aria-label="新技术/方向"><!--[--><!--]--> 新技术/方向 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://hezhuoyi.github.io/leetcode" rel="noopener noreferrer" target="_blank" aria-label="LeetCode"><!--[--><!--]--> LeetCode <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/hezhuoyi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://juejin.cn/user/3597257778155703" rel="noopener noreferrer" target="_blank" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">浏览器相关</p><ul class=""><li><!--[--><a href="/blog/Browser/" class="nav-link router-link-active sidebar-item" aria-label="概览"><!--[--><!--]--> 概览 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-item" aria-label="浏览器工作原理"><!--[--><!--]--> 浏览器工作原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" class="nav-link sidebar-item" aria-label="浏览器性能优化"><!--[--><!--]--> 浏览器性能优化 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98.html" class="nav-link sidebar-item" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Browser/%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="从输入URL到页面呈现"><!--[--><!--]--> 从输入URL到页面呈现 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/blog/Browser/%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0.html#网络篇" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="网络篇"><!--[--><!--]--> 网络篇 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Browser/%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0.html#解析算法篇" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="解析算法篇"><!--[--><!--]--> 解析算法篇 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Browser/%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%91%88%E7%8E%B0.html#渲染过程篇" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="渲染过程篇"><!--[--><!--]--> 渲染过程篇 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/blog/Browser/v8%E5%BC%95%E6%93%8E.html" class="nav-link sidebar-item" aria-label="v8引擎"><!--[--><!--]--> v8引擎 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="从输入url到页面呈现" tabindex="-1"><a class="header-anchor" href="#从输入url到页面呈现" aria-hidden="true">#</a> 从输入URL到页面呈现</h1><h2 id="网络篇" tabindex="-1"><a class="header-anchor" href="#网络篇" aria-hidden="true">#</a> 网络篇</h2><p><strong>1. 构建请求--浏览器会构建请求行</strong></p><p><strong>2.查找强缓存</strong></p><p>当浏览器发现请求的资源已经在浏览器缓存中存有副本，<strong>它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载</strong>。</p><p>Expires =&gt; Cache-Control 从过期时间变成过期时长 max-age就是确定缓存的时间<strong>秒</strong>。</p><p><strong>3. DNS解析</strong>（淘宝京东这种网站一般使用<strong>DNS预解析</strong>跨过这一步，浏览器会在加载网页时对网页中的域名进行解析缓存，这样在你单击当前网页中的连接时就无需进行DNS的解析）<strong>（准备 IP 地址和端口）</strong></p><p><img src="/blog/assets/img/js-DNS解析.95bc94fe.png" alt="DNS解析"></p><p>这个过程需要依赖一个服务系统，这个系统将域名和 IP 一一映射，我们将这个系统就叫做<strong>DNS</strong>（域名系统）。得到具体 IP 的过程就是<code>DNS</code>解析。浏览器提供了<strong>DNS数据缓存功能</strong>。即如果一个域名已经解析过，那会把解析的结果缓存下来，下次处理直接走缓存，不需要经过 <code>DNS解析</code>。</p><p><strong>浏览器缓存：浏览器会按照一定的频率缓存 DNS 记录。</strong></p><p><strong>操作系统缓存：如果浏览器缓存中找不到需要的 DNS 记录，那就去操作系统中找。</strong></p><p><strong>路由缓存：路由器也有 DNS 缓存。</strong></p><p><strong>互联网服务提供商 的 DNS 服务器：ISP 有专门的 DNS 服务器应对 DNS 查询请求。</strong></p><p><strong>根服务器：ISP 的 DNS 服务器还找不到的话，它就会向根服务器发出请求，进行递归查询（DNS 服务器先问根域名服务器.com 域名服务器的 IP 地址，然后再问.baidu 域名服务器，依次类推）</strong></p><p>之后<strong>如果请求协议是 HTTPS，那么还需要建立 SSL/TLS 连接。</strong></p><h5 id="_3-5等待-tcp-队列" tabindex="-1"><a class="header-anchor" href="#_3-5等待-tcp-队列" aria-hidden="true">#</a> 3.5等待 TCP 队列</h5><p>Chrome 有个机制，<strong>同一个域名同时最多只能请求 6 个 TCP 连接</strong>，如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队<strong>等待状态</strong>，直至进行中的请求完成。如果当前请求数量少于 6 ，会直接进入下一步，建立 TCP 连接。</p><p><strong>4.建立 TCP 连接</strong></p><ol><li>通过<strong>三次握手</strong>(即总共发送3个数据包确认已经建立连接)建立客户端和服务器之间的连接。</li><li>进行<strong>数据传输</strong>。这里有一个重要的机制，就是<strong>接收方接收到数据包后必须要向发送方<code>确认</code>, 如果发送方没有接到这个<code>确认</code>的消息，就判定为数据包丢失，并重新发送该数据包</strong>。当然，发送的过程中还有一个优化策略，就是把<code>大的数据包拆成一个个小包</code>，依次传输到接收方，接收方按照这个小包的顺序把它们<code>组装</code>成完整数据包。</li><li>断开连接的阶段。数据传输完成，现在要断开连接了，通过<strong>四次挥手</strong>来断开连接。</li></ol><p>读到这里，你应该明白 TCP 连接通过什么手段来保证数据传输的可靠性，<strong>一是<code>三次握手</code>确认连接，二是<code>数据包校验</code>保证数据到达接收方，三是通过<code>四次挥手</code>断开连接。</strong></p><p><strong>5.发送 HTTP 请求</strong></p><p>浏览器发 HTTP 请求要携带三样东西:<strong>请求行</strong>、<strong>请求头</strong>和<strong>请求体</strong>。</p><p><strong>6.网络响应</strong></p><p>网络响应具有三个部分:<strong>响应行</strong>、<strong>响应头</strong>和<strong>响应体</strong>。</p><p>如果请求头或响应头中包含<strong>Connection: Keep-Alive</strong>，表示建立了持久连接，这样<code>TCP</code>连接会一直保持，之后请求统一站点的资源会复用这个连接。</p><p>否则断开<code>TCP</code>连接, 请求-响应流程结束。</p><h3 id="三次握手四次挥手及意义" tabindex="-1"><a class="header-anchor" href="#三次握手四次挥手及意义" aria-hidden="true">#</a> 三次握手四次挥手及意义</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>建立TCP连接时，需要客户端和服务器共发送3个包。
• 第一次：客户端发送初始序号x和syn=1请求标志
• 第二次：服务器发送请求标志syn，发送确认标志ACK，发送自己的序号seq=y，发送客户端的确认序号ack=x+1
• 第三次：客户端发送ACK确认号，发送自己的序号seq=x+1，发送对方的确认号ack=y+1

• 第一次挥手：客户端发出释放FIN=1，自己序列号seq=u，进入FIN-WAIT-1状态
• 第二次挥手：服务器收到客户端的后，发出ACK=1确认标志和客户端的确认号ack=u+1，自己的序列号seq=v，进入CLOSE-WAIT状态
• 第三次挥手：客户端收到服务器确认结果后，进入FIN-WAIT-2状态。此时服务器发送释放FIN=1信号，确认标志ACK=1，确认序号ack=u+1，自己序号seq=w，服务器进入LAST-ACK（最后确认态）
• 第四次挥手：客户端收到回复后，发送确认ACK=1，ack=w+1，自己的seq=u+1，客户端进入TIME-WAIT（时间等待）。客户端经过2个最长报文段寿命后，客户端CLOSE；服务器收到确认后，立刻进入CLOSE状态。

三次握手时，服务器同时把ACK和SYN放在一起发送到了客户端那里
四次挥手时，当收到对方的 FIN 报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方是否现在关闭发送数据通道，需要上层应用来决定，因此，己方 ACK 和 FIN 一般都会分开发送。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="/blog/assets/img/js-网络响应.f8dc9857.png" alt="网络响应"></p><p>默认情况下，Chrome 会为每个页面分配一个渲染进程。</p><h2 id="解析算法篇" tabindex="-1"><a class="header-anchor" href="#解析算法篇" aria-hidden="true">#</a> 解析算法篇</h2><p><strong>浏览器解析：1.构建 DOM树 =&gt;2.样式计算 =&gt;3.生成布局树</strong></p><p>大厂网站首屏优化：将<strong>首屏内容静态化在html里面</strong>，直接<strong>解析DOM时渲染出来</strong></p><p>紧邻首屏的内容，如果不能包含在html中静态化，那么可以让在在页面渲染后，立刻执行<strong>异步获取数据</strong></p><h3 id="构建-dom-树" tabindex="-1"><a class="header-anchor" href="#构建-dom-树" aria-hidden="true">#</a> 构建 DOM 树</h3><p><strong>输入 HTML 文件，然后经由 HTML 解析器解析，最终输出保存在内存中树状结构 DOM。</strong></p><p>由于浏览器无法直接理解<code>HTML字符串</code>，因此将这一系列的<strong>字节流转换为一种有意义并且方便操作的数据结构，这种数据结构就是<code>DOM树</code></strong>。<code>DOM树</code>本质上是一个以<code>document</code>为根节点的多叉树。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1.先浏览器从磁盘或网络中读取 `HTML` 原始字节(0 和 1)，并根据文件的指定编码将它们转成字符。

2.分词器通过词法分析将字节流转换为 `Token`，这一过程在词法分析中叫做标记化（tokenization）。
在`Token`（也就是令牌）生成的同时，另一个流程会同时消耗这些令牌并转换成 `HTML head` 这些节点对象，起始和结束令牌表明了节点之间的关系（Node）。

3.当所有的令牌消耗完以后就转换成了`DOM`（文档对象模型）。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>构建 CSSOM 树流程类似，之后渲染引擎就会构造布局树并过滤不需要显示的元素。</p><p><strong>字节数据 =&gt; 字符串 =&gt; Token =&gt; Node =&gt; DOM（CSSOM）</strong></p><h4 id="解析算法-1-标记化-2-建树" tabindex="-1"><a class="header-anchor" href="#解析算法-1-标记化-2-建树" aria-hidden="true">#</a> 解析算法 1.标记化 2.建树</h4><h5 id="标记化算法" tabindex="-1"><a class="header-anchor" href="#标记化算法" aria-hidden="true">#</a> 标记化算法</h5><p>这个算法输入为<code>HTML文本</code>，输出为<code>HTML标记</code>，也成为<strong>标记生成器</strong>。其中运用<strong>有限自动状态机</strong>来完成。即在当当前状态下，接收一个或多个字符，就会更新到下一个状态。</p><h5 id="建树算法" tabindex="-1"><a class="header-anchor" href="#建树算法" aria-hidden="true">#</a> 建树算法</h5><p>之前提到过，DOM 树是一个以<code>document</code>为根节点的多叉树。因此解析器首先会创建一个<code>document</code>对象。标记生成器会把每个标记的信息发送给<strong>建树器</strong>。<strong>建树器</strong>接收到相应的标记时，会<strong>创建对应的 DOM 对象</strong>。创建这个<code>DOM对象</code>后会做两件事情:</p><ol><li>将<code>DOM对象</code>加入 DOM 树中。</li><li>将对应标记压入存放开放(与<code>闭合标签</code>意思对应)元素的栈中。</li></ol><h3 id="样式计算" tabindex="-1"><a class="header-anchor" href="#样式计算" aria-hidden="true">#</a> 样式计算</h3><p><strong>3种来源：link标签引用 style标签中的样式 元素的内嵌style属性</strong></p><p><strong>格式化样式表（document.styleSheets） =&gt; 标准化样式属性 比如：blue-&gt;rgb(0,0,255) =&gt; 计算每个节点的具体样式 =&gt; 生成布局树</strong></p><p><img src="/blog/assets/img/js-样式计算.35464c89.png" alt="样式计算"></p><h2 id="渲染过程篇" tabindex="-1"><a class="header-anchor" href="#渲染过程篇" aria-hidden="true">#</a> 渲染过程篇</h2><ul><li><strong>1.建立图层树</strong></li><li><strong>2.生成绘制列表</strong> -- 渲染引擎</li><li>3.绘制：<strong>生成图块和生成位图并栅格化</strong> -- 渲染引擎中的合成线程</li><li><strong>4.显示器显示内容</strong></li></ul><h3 id="一、建图层树" tabindex="-1"><a class="header-anchor" href="#一、建图层树" aria-hidden="true">#</a> 一、建图层树</h3><p><strong>渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树。</strong>(两种方式)</p><p>通常情况下，并不是布局树的每个节点都包含一个图层，如果一个节点没有对应的层，那么这个节点就从属于父节点的图层。</p><h4 id="显示合成" tabindex="-1"><a class="header-anchor" href="#显示合成" aria-hidden="true">#</a> 显示合成</h4><p>一、 拥有<strong>层叠上下文属性的元素</strong>的节点。</p><p>二、需要<strong>剪裁</strong>的地方。</p><h4 id="隐式合成" tabindex="-1"><a class="header-anchor" href="#隐式合成" aria-hidden="true">#</a> 隐式合成</h4><p>简单来说就是<code>层叠等级低</code>的节点被提升为单独的图层之后，那么<code>所有层叠等级比它高</code>的节点<strong>都会</strong>成为一个单独的图层。可能发生层爆炸。</p><h3 id="二、生成绘制列表" tabindex="-1"><a class="header-anchor" href="#二、生成绘制列表" aria-hidden="true">#</a> 二、生成绘制列表</h3><p><strong>渲染引擎</strong>会将<strong>图层的绘制拆分成一个个绘制指令</strong>，比如先画背景、再描绘边框......然后将这些指令按顺序组合成一个待绘制列表，相当于给后面的绘制操作做了一波计划。</p><h3 id="三、生成图块和生成位图" tabindex="-1"><a class="header-anchor" href="#三、生成图块和生成位图" aria-hidden="true">#</a> 三、生成图块和生成位图</h3><p>绘制列表只是用来记录绘制顺序和绘制指令的列表，而实际上<strong>绘制操作是由渲染引擎中的合成线程</strong>来完成的。</p><p>当图层的绘制列表准备好之后，主线程会把该绘制列表提交给合成线程，<strong>合成线程会将图层划分为图块</strong>，然后合成线程会<strong>按照视口附近的图块来优先生成位图</strong>，实际生成位图的操作是由栅格化来执行的。所谓栅格化，是指将图块转换为位图。而图块是栅格化执行的最小单位。<strong>渲染进程维护了一个栅格化的线程池，所有的图块栅格化都是在线程池内执行的。</strong></p><p>生成位图的过程实际上都会使用 <strong>GPU 进行加速</strong>，<strong>生成的位图最后发送给合成线程</strong>。</p><h3 id="四、显示器显示内容" tabindex="-1"><a class="header-anchor" href="#四、显示器显示内容" aria-hidden="true">#</a> 四、显示器显示内容</h3><p>栅格化操作完成后，<strong>合成线程</strong>会生成一个绘制命令，即&quot;DrawQuad&quot;，并发送给浏览器进程。</p><p>浏览器进程中的<code>viz组件</code>接收到这个命令，根据这个命令，把<strong>页面内容绘制到内存</strong>，最后再将内存显示在<strong>屏幕</strong>上。</p><p><img src="/blog/assets/img/js-显示器显示内容.2ccf05e8.png" alt="显示器显示内容"></p><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/blog/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98.html" class="nav-link" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a></span><span class="next"><a href="/blog/Browser/v8%E5%BC%95%E6%93%8E.html" class="nav-link" aria-label="v8引擎"><!--[--><!--]--> v8引擎 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/blog/assets/js/runtime~app.5b40ce10.js" defer></script><script src="/blog/assets/js/981.9765ac40.js" defer></script><script src="/blog/assets/js/app.3e27996d.js" defer></script>
  </body>
</html>

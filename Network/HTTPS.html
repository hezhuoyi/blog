<!DOCTYPE html>
<html lang="zh-US">
  <head>
    <link rel="manifest" href="/blog/manifest.webmanifest"><title>HTTPS | Johnny's blog</title><meta name="description" content="认真分享和记录各类好文，逐步完善大前端知识体系。"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.22">
    <link rel="preload" href="/blog/assets/js/runtime~app.5b40ce10.js" as="script"><link rel="preload" href="/blog/assets/css/styles.678e5aee.css" as="style"><link rel="preload" href="/blog/assets/js/981.9765ac40.js" as="script"><link rel="preload" href="/blog/assets/js/app.3e27996d.js" as="script">
    <link rel="stylesheet" href="/blog/assets/css/styles.678e5aee.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/blog/" class=""><!----><span class="site-name">Johnny&#39;s blog</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/blog/JavaScript/" class="nav-link" aria-label="深入JavaScript"><!--[--><!--]--> 深入JavaScript <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Network/" class="nav-link router-link-active" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Browser/" class="nav-link" aria-label="浏览器相关"><!--[--><!--]--> 浏览器相关 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Framework/" class="nav-link" aria-label="框架和类库"><!--[--><!--]--> 框架和类库 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Engineering/" class="nav-link" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/NewTechnology/" class="nav-link" aria-label="新技术/方向"><!--[--><!--]--> 新技术/方向 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://hezhuoyi.github.io/leetcode" rel="noopener noreferrer" target="_blank" aria-label="LeetCode"><!--[--><!--]--> LeetCode <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/hezhuoyi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://juejin.cn/user/3597257778155703" rel="noopener noreferrer" target="_blank" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/blog/JavaScript/" class="nav-link" aria-label="深入JavaScript"><!--[--><!--]--> 深入JavaScript <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Network/" class="nav-link router-link-active" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Browser/" class="nav-link" aria-label="浏览器相关"><!--[--><!--]--> 浏览器相关 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Framework/" class="nav-link" aria-label="框架和类库"><!--[--><!--]--> 框架和类库 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/Engineering/" class="nav-link" aria-label="前端工程化"><!--[--><!--]--> 前端工程化 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/blog/NewTechnology/" class="nav-link" aria-label="新技术/方向"><!--[--><!--]--> 新技术/方向 <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://hezhuoyi.github.io/leetcode" rel="noopener noreferrer" target="_blank" aria-label="LeetCode"><!--[--><!--]--> LeetCode <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/hezhuoyi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://juejin.cn/user/3597257778155703" rel="noopener noreferrer" target="_blank" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">计算机网络</p><ul class=""><li><!--[--><a href="/blog/Network/" class="nav-link router-link-active sidebar-item" aria-label="概览"><!--[--><!--]--> 概览 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog/Network/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-item" aria-label="编译原理"><!--[--><!--]--> 编译原理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog/Network/HTTP.html" class="nav-link sidebar-item" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Network/HTTPS.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="HTTPS"><!--[--><!--]--> HTTPS <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/blog/Network/HTTPS.html#http-的缺点" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="HTTP 的缺点"><!--[--><!--]--> HTTP 的缺点 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Network/HTTPS.html#https-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="HTTPS"><!--[--><!--]--> HTTPS <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Network/HTTPS.html#https的握手过程" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="HTTPS的握手过程"><!--[--><!--]--> HTTPS的握手过程 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Network/HTTPS.html#http2" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="HTTP2"><!--[--><!--]--> HTTP2 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/blog/Network/HTTPS.html#http3" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="HTTP3"><!--[--><!--]--> HTTP3 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/blog/Network/RPC.html" class="nav-link sidebar-item" aria-label="RPC"><!--[--><!--]--> RPC <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/blog/Network/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.html" class="nav-link sidebar-item" aria-label="网络安全"><!--[--><!--]--> 网络安全 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="https" tabindex="-1"><a class="header-anchor" href="#https" aria-hidden="true">#</a> HTTPS</h1><h2 id="http-的缺点" tabindex="-1"><a class="header-anchor" href="#http-的缺点" aria-hidden="true">#</a> HTTP 的缺点</h2><p>HTTP 在通信过程中会面临以下三种安全问题：</p><ul><li>通信使用明文（不加密），内容可能会被窃听。</li><li>不验证通信方的身份，可能会遭遇伪装。</li><li>无法验证报文的完整性，可能已经被篡改。</li></ul><h2 id="https-1" tabindex="-1"><a class="header-anchor" href="#https-1" aria-hidden="true">#</a> HTTPS</h2><p><strong>HTTPS使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性。</strong></p><p>HTTPS = HTTP + 加密 + 认证 + 摘要</p><h3 id="_2-1-https-是身披-ssl-安全套接层-外壳的-http" tabindex="-1"><a class="header-anchor" href="#_2-1-https-是身披-ssl-安全套接层-外壳的-http" aria-hidden="true">#</a> 2.1 HTTPS 是身披 SSL （安全套接层）外壳的 HTTP</h3><p><strong>SSL和TLS(安全传输层协议)都是加密协议</strong>。</p><p>HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL 和 TLS 协议代替而已。</p><p>通常，HTTP 直接和 TCP 通信。当使用 SSL 的时候，就先和 SSL 通信，再由 SSL 和 TCP 通信了。所以简而言之，HTTPS 就是身披 SSL 外壳的 HTTP 协议。</p><h3 id="_2-2-相互交换密钥的公开密钥加密技术" tabindex="-1"><a class="header-anchor" href="#_2-2-相互交换密钥的公开密钥加密技术" aria-hidden="true">#</a> 2.2 相互交换密钥的公开密钥加密技术</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>HTTPS 为什么同时要有对称加密和非对称加密两种加密方式？ 对称加密的密钥 =&gt; SK
1). 首先一定要明确HTTPS既有对称加密，又有非对称加密。
2).由于对称加密性能高速度快，因此在传输数据时（也就是对话内容）采用对称加密。
3).但是对称加密的密钥SK，既没办法预先设置（密钥不可能只有一把，服务器端维护大量密钥也不具备可行性），因此只能选择在对话前通过网络协商出一把新的SK。
4). 为了确保SK的传输安全，使用非对称加密来协商SK。

HTTPS 对称加密的密钥 SK 如何产生和传输？
通过第一个问题，我们知道了 HTTPS 分为2 个过程：
1.协商对称加密密钥 SK 的非对称加密阶段，称为TLS 握手阶段。
2.使用 SK 对数据（对话内容）进行对称加密的阶段，称为数据通信阶段。

过程 1TLS 握手阶段：协商密钥 SK。
基于非对称加密算法
基于专用密钥交换算法，常见有 DH、ECDH 等
基于共享的 secret，常见有 PSK，SRP 等
过程 2数据通信阶段：发送端首先用密钥 SK 对通信内容进行对称加密，接着通过网络传输出去；对端收到数据后，用 SK 先将数据解密，于是就得到了通信内容
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_2-2-1-共享密钥加密的困境" tabindex="-1"><a class="header-anchor" href="#_2-2-1-共享密钥加密的困境" aria-hidden="true">#</a> 2.2.1 共享密钥加密的困境</h4><p><strong>加密和解密使用同一个密钥的方式称为共享密钥加密（Common key crypto system），也被叫做对称密钥加密</strong>。</p><p>采用共享密钥加密方式加密时，需要将密钥一起发送给通信方，所以有需要考虑密钥传输的安全性，需要<strong>设法安全地保管密钥</strong>，这便是共享密钥加密方式的困扰。</p><h4 id="_2-2-2-使用两把密钥加密的公开密钥加密方式" tabindex="-1"><a class="header-anchor" href="#_2-2-2-使用两把密钥加密的公开密钥加密方式" aria-hidden="true">#</a> 2.2.2 使用两把密钥加密的公开密钥加密方式</h4><p><strong>公开密钥加密方式</strong>很好的解决了共享密钥加密方式的困扰。</p><p>公开密钥加密使用一对<strong>非对称的密钥</strong>。一把叫做私有密钥（private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不能被其他任何人知道，而公开密钥则可以任意传播，任何人都可以拿到。</p><p>使用公开密钥加密方式（非对称加密），发送密文的一方使用公钥进行加密处理，而接收方拿到被加密后的信息之后再使用自己的私钥进行解密。利用这种方式进行传输，就<strong>不需要发送密钥，也就不用担心密钥被攻击者拿走了</strong>。</p><h4 id="_2-2-3-https-采用混合加密机制" tabindex="-1"><a class="header-anchor" href="#_2-2-3-https-采用混合加密机制" aria-hidden="true">#</a> 2.2.3 HTTPS 采用混合加密机制</h4><p><strong>HTTPS 采用共享密钥加密方式和公开密钥加密方式混用的加密方式</strong>。</p><p><strong>HTTPS 在内容传输的加密上使用的是对称加密，非对称加密只作用在证书验证阶段。</strong></p><p>如果密钥可以被安全传输，则 HTTPS 会考虑采用共享密钥加密方式，否则将采用公开密钥加密方式。这是因为公开密钥加密方式的速度比共享密钥加密方式要慢。HTTPS 充分地利用了两者的优点，将多种方法组合起来用于通信。<strong>在使用公开密钥加密方式交换密钥之后，之后的信息传输使用共享密钥加密方式</strong>。</p><h3 id="_2-3-证明公开密钥正确性的证书" tabindex="-1"><a class="header-anchor" href="#_2-3-证明公开密钥正确性的证书" aria-hidden="true">#</a> 2.3 证明公开密钥正确性的证书</h3><p><strong>数字证书用于主体身份验证。</strong> <strong>数字证书=主体信息+数字签名</strong>。</p><p>因为无法证明公开密钥本身就是真的公开密钥，由CA(数字证书认证机构)颁发公开密钥证书。</p><p>下面讲解一下数字证书认证机构的业务流程：</p><ol><li><strong>服务器的运营人员会向数字机构提出公开密钥申请。</strong></li><li><strong>CA 在认证申请者的身份信息之后，会对已申请的公开密钥进行数字签名。</strong></li><li><strong>然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书之后绑定在一起。</strong></li><li><strong>服务器会将这份 CA 颁发的公钥证书发送给客户端，以进行公钥加密方式通信，公钥证书也可叫做数字证书或者直接称为证书。</strong></li></ol><p>接到证书的客户端可使用 CA 的公钥对证书的数字签名进行认证，一旦验证通过，客户端便可确认两件事：</p><ul><li>认证服务器公钥的机构是真实有效的 CA 机构</li><li>服务器的公钥是值得信任的</li></ul><p>于是这就达到了确认公钥真实有效性的目的。</p><h2 id="https的握手过程" tabindex="-1"><a class="header-anchor" href="#https的握手过程" aria-hidden="true">#</a> HTTPS的握手过程</h2><p>SSL类似于TCP的三次握手，在HTTP链接建立之前进行四次握手，从而客户度和服务端沟通好HTTP传输时对称加密的密钥，SSL的四次握手其过程如下：</p><ol><li><p><strong>客户端请求建立SSL连接，发送支持的加密方式以及一个随机数client random给服务器；</strong></p></li><li><p><strong>服务器选择其中的一种加密方式，并且再加上另外一个随机数server random，和数字证书（其中有公钥），发送给客户端；</strong></p></li><li><p><strong>客户端确认这个数字证书是有效的，并且再生成一个新的随机数，将这个随机数用服务器发送给它的数字证书中的公钥进行加密发送给服务器；</strong></p></li><li><p><strong>服务器收到客户端的回复，利用自己的私钥进行解密，获得这个随机数，然后通过将前面这三个随机数以及他们协商的加密方式，计算生成一个对称密钥。</strong></p></li><li><p><strong>至此握手阶段完成，之后的会话他们就通过这个对称密钥进行加密传输。</strong></p></li></ol><h2 id="http2" tabindex="-1"><a class="header-anchor" href="#http2" aria-hidden="true">#</a> HTTP2</h2><p>HTTP 2.0 相比于 HTTP 1.X，可以说是大幅度提高了 web 的性能。</p><p>在 HTTP 1.X 中，为了性能考虑，我们会引入雪碧图、将小图内联、使用多个域名等等的方式。这一切都是因为浏览器限制了同一个域名下的请求数量，当页面中需要请求很多资源的时候，队头阻塞（Head of line blocking）会导致在达到最大请求数量时，剩余的资源需要等待其他资源请求完成后才能发起请求。</p><h3 id="二进制分帧" tabindex="-1"><a class="header-anchor" href="#二进制分帧" aria-hidden="true">#</a> 二进制分帧</h3><p>帧：HTTP/2 数据通信的最小单位消息：指 HTTP/2 中逻辑上的 HTTP 消息。例如请求和响应等，消息由一个或多个帧组成。</p><p>流：存在于连接中的一个虚拟通道。流可以承载双向消息，每个流都有一个唯一的整数ID。</p><p>HTTP 2.0 中所有加强性能的核心点在于此。在之前的 HTTP 版本中，我们是通过文本的方式传输数据。在 HTTP 2.0 中引入了新的编码机制，所有传输的数据都会被分割，并采用<strong>二进制格式编码</strong>。</p><p><strong>HTTP/2 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流</strong>。每个数据流都以消息的形式发送，而消息又由一个或多个帧组成。多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装。</p><h3 id="多路复用" tabindex="-1"><a class="header-anchor" href="#多路复用" aria-hidden="true">#</a> 多路复用</h3><p>多路复用，<strong>就是在一个 TCP 连接中可以存在多条流</strong>。换句话说，也就是可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以避免 HTTP 旧版本中的队头阻塞问题，极大的提高传输性能。</p><h3 id="header-压缩" tabindex="-1"><a class="header-anchor" href="#header-压缩" aria-hidden="true">#</a> Header 压缩</h3><p>在 HTTP 1.X 中，我们使用文本的形式传输 header，在 header 携带 cookie 的情况下，可能每次都需要重复传输几百到几千的字节。</p><p>在 HTTP 2.0 中，使用了 HPACK 压缩格式对传输的 header 进行编码，减少了 header 的大小。并在<strong>两端维护了索引表</strong>，用于记录出现过的 header ，后面在传输过程中就可以传输已经记录过的 header 的键名，对端收到数据后就可以通过键名找到对应的值。</p><h3 id="服务端-push" tabindex="-1"><a class="header-anchor" href="#服务端-push" aria-hidden="true">#</a> 服务端 Push</h3><p>在 HTTP 2.0 中，服务端可以在客户端某个请求后，主动推送其他资源。</p><p>可以想象以下情况，某些资源客户端是一定会请求的，这时就可以采取服务端 push 的技术，<strong>提前给客户端推送必要的资源</strong>，这样就可以相对减少一点延迟时间。当然在浏览器兼容的情况下你也可以使用 prefetch 。</p><p><strong>流的特性</strong></p><p><strong>并发性</strong>。一个 HTTP/2 连接上可以同时发多个帧，这一点和 HTTP/1 不同。这也是实现<strong>多路复用</strong>的基础。</p><p><strong>自增性</strong>。流 ID 是不可重用的，而是会按顺序递增，达到上限之后又新开 TCP 连接从头开始。</p><p><strong>双向性</strong>。客户端和服务端都可以创建流，互不干扰，双方都可以作为<code>发送方</code>或者<code>接收方</code>。</p><p><strong>可设置优先级</strong>。可以设置数据帧的优先级，让服务端先处理重要资源，优化用户体验。</p><h2 id="http3" tabindex="-1"><a class="header-anchor" href="#http3" aria-hidden="true">#</a> HTTP3</h2><h3 id="http3的优化" tabindex="-1"><a class="header-anchor" href="#http3的优化" aria-hidden="true">#</a> HTTP3的优化</h3><p><img src="/blog/assets/img/http3.e72f0a57.png" alt="http3"></p><h3 id="http2的缺点" tabindex="-1"><a class="header-anchor" href="#http2的缺点" aria-hidden="true">#</a> HTTP2的缺点</h3><p>虽然 HTTP/2 解决了很多之前旧版本的问题，但是它还是存在一个巨大的问题，主要是底层支撑的 TCP 协议造成的。HTTP/2的缺点主要有以下几点：</p><ol><li>TCP 以及 TCP+TLS建立连接的延时</li><li>TCP的队头阻塞并没有彻底解决</li></ol><h3 id="quic协议" tabindex="-1"><a class="header-anchor" href="#quic协议" aria-hidden="true">#</a> QUIC协议</h3><p>QUIC 协议选择了 UDP，因为 UDP 本身没有连接的概念，<strong>不需要三次握手，优化了连接建立的握手延迟</strong>，同时在应用程序层面实现了 TCP 的可靠性，TLS 的安全性和 HTTP2 的并发性，只需要用户端和服务端的应用程序支持 QUIC 协议，完全避开了操作系统和中间设备的限制。</p><p>运行在 QUIC 之上的 HTTP 协议被称为 HTTP/3(HTTP-over-QUIC)</p><p>QUIC 协议(Quick UDP Internet Connection)基于 UDP，正是看中了 <strong>UDP 的速度与效率</strong>。同时 QUIC 也整合了 TCP、TLS 和 HTTP/2 的优点，并加以优化。</p><p>特点:</p><ol><li>减少了握手的延迟(1-RTT 或 0-RTT)</li><li>多路复用，并且没有 TCP 的阻塞问题</li><li>连接迁移，(主要是在客户端)当由 Wifi 转移到 4G 时，连接不会被断开。</li></ol><p>QUIC 解决队头阻塞问题的方法：</p><ol><li>QUIC 的传输单元是 Packet，加密单元也是 Packet，整个加密、传输、解密都基于 Packet，这样就能避免 TLS 的队头阻塞问题。</li><li>QUIC 基于 UDP，UDP 的数据包在接收端<strong>没有处理顺序</strong>，即使中间丢失一个包，也不会阻塞整条连接，其他的资源会被正常处理。</li></ol><h4 id="quic-基于-udp-怎么保证可靠性" tabindex="-1"><a class="header-anchor" href="#quic-基于-udp-怎么保证可靠性" aria-hidden="true">#</a> QUIC 基于 UDP 怎么保证可靠性？</h4><p>TCP 中通过三次握手，给每一份数据包添加序列，以及重试机制，保证可靠性。而 QUIC 在 UDP 的基础上，增加了一层实现 TCP 类似的功能。</p><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/blog/Network/HTTP.html" class="nav-link" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a></span><span class="next"><a href="/blog/Network/RPC.html" class="nav-link" aria-label="RPC"><!--[--><!--]--> RPC <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/blog/assets/js/runtime~app.5b40ce10.js" defer></script><script src="/blog/assets/js/981.9765ac40.js" defer></script><script src="/blog/assets/js/app.3e27996d.js" defer></script>
  </body>
</html>

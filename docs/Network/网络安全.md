# 网络安全

**常见 Web 攻击技术**

## 跨站脚本攻击 XSS

跨站脚本攻击（Cross-Site Scripting， XSS）是指通过**存在安全漏洞的 Web 网站注册用户的浏览器内运行非法的 HTML 标签或者 JavaScript 代码**的一种攻击方式。**动态创建的 HTML 可能存在安全漏洞**。

该攻击可能造成以下影响：

- 利用**虚假输入表单**骗取用户个人信息
- 利用脚本窃取用户的 **Cookie** 值，被害者在不知情的情况下，帮助攻击者发送恶意请求
- 显示**伪造的文章或者图片和广告**

防范：

- 一个信念: 不要相信用户的输入，对**输入内容转码或者过滤，让其不可执行**。
- 两个利用: 利用 **CSP**(内容安全策略)，它的核心思想就是**服务器决定浏览器加载哪些资源**，利用 Cookie 的 **HttpOnly** 属性（js脚本将无法读取到cookie信息）。

## 跨站请求伪造 CSRF

攻击者借助受害者的 Cookie 骗取服务器的信任，可以在受害者毫不知情的情况下以受害者名义伪造请求发送给受攻击服务器，从而在并未授权的情况下执行在权限保护之下的操作。

**诱导自动发 GET POST 请求**

CSRF 攻击并不需要将恶意代码注入用户当前页面的`html`文档中，而是跳转到新的页面，利用服务器的**验证漏洞**和**用户之前的登录状态**来模拟用户进行操作。

防范：

1. 利用Cookie的**SameSite**属性，对请求中 Cookie 的携带作一些限制，**Strict模式下，浏览器完全禁止第三方请求携带Cookie。**

2. 验证来源站点 **Origin**和**Referer**。

## SQL 注入攻击

SQL 注入（SQL Injection）是**指针对 Web 应用使用的数据库，通过运行非法的 SQL 而产生的攻击**。该安全隐患有可能引发极大的安全威胁，有时会直接导致个人信息及机密信息的泄露。

SQL 注入可能会导致如下影响：

- 非法查看或篡改数据库内的数据
- 规避认证
- 执行和数据库服务器业务关联的程序等

防范：

**不要使用动态SQL**  **不要将敏感数据保留在纯文本中**   **限制数据库权限和特权**   **使用Web应用程序防火墙**

## 跨域解决方案

1. **通过jsonp跨域**

通常为了减轻web服务器的负载，我们把js、css，img等静态资源分离到另一台独立域名的服务器上，在html页面中再通过相应的标签从不同域名下加载静态资源，而被浏览器允许，基于此原理，我们可以通过动态创建script，再请求一个带参网址实现跨域通信。

2. **跨域资源共享（CORS）**

CORS，是 HTML5 的一项特性，它定义了一种浏览器和服务器交互的方式来确定是否允许跨域请求。

3. **nodejs中间件代理跨域**

跨域原理: 同源策略是浏览器的安全策略, 不是HTTP协议的一部分。服务器端调用HTTP接口只是使用HTTP协议，不会执行js脚本, 不需要检验同源策略,也就不存在跨域问题。

实现思路：通过起一个代理服务器，实现数据的转发，也可以通过设置cookieDomainRewrite参数修改响应头cookie中域名,实现当前域下cookie的写入。

4. nginx反向代理中设置proxy_cookie_domain

和使用node中间件跨域原理相似。前端和后端都不需要写额外的代码来处理， 只需要配置一下Ngnix。

5. **postMessage**

postMessage()方法允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递。

6. **websocket**

Websocket是HTML5的一个持久化的协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。WebSocket和HTTP都是应用层协议，都基于 TCP 协议。但是 WebSocket 是一种双向通信协议，在建立连接之后，WebSocket 的 server 与 client 都能主动向对方发送或接收数据。